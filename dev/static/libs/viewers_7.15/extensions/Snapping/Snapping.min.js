/*!
 * LMV v7.15.2
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Snapping=function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=327)}({0:function(e,t){e.exports=THREE},327:function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=Autodesk.Viewing,l=AutodeskNamespace("Autodesk.Viewing.Extensions.Snapping");function u(t,i){for(var r in t)t.hasOwnProperty(r)&&(e.exports[r]=t[r],i[r]=t[r])}u(i(79),l),u(i(589),l),u(i(80),l);var h=function(e){"use strict";function t(e,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,o(t).call(this,e,i))}var i,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,e),i=t,(r=[{key:"load",value:function(){return this.viewer.loadExtension("Autodesk.CompGeom")}},{key:"unload",value:function(){return!0}},{key:"activate",value:function(){return!0}},{key:"deactivate",value:function(){return!1}}])&&s(i.prototype,r),c&&s(i,c),t}(c.Extension);c.theExtensionManager.registerExtension("Autodesk.Snapping",h)},50:function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},589:function(e,t,i){"use strict";i.r(t);var r=i(80),s=i(81),n=i(0),o=2*Math.PI;function a(e){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.ib=e.ib,this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=e.numInstances>0,this.useCompactBuffers=e.unpackXform,this.texData=this.useCompactBuffers&&e.tIdColor&&e.tIdColor.image&&e.tIdColor.image.data&&new Uint32Array(e.tIdColor.image.data.buffer)}function c(e){this.bounds=e,this.point=new n.Vector4,this.point.z=0,this.point.w=1}a.prototype.getDbIdAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+7]]:this.vbi[e*this.stride+7]},a.prototype.getColorAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+6]]:this.vbi[e*this.stride+6]},a.prototype.getVertexFlagsAt=function(e){return this.texData?this.vbi[e*this.stride+4]:this.vbi[e*this.stride+8]},a.prototype.getLayerIndexAt=function(e){return this.texData?65535&this.vbi[e*this.stride+5]:65535&this.vbi[e*this.stride+9]},a.prototype.getViewportIndexAt=function(e){return this.texData?this.vbi[e*this.stride+5]>>16&65535:this.vbi[e*this.stride+9]>>16&65535},a.prototype.decodeLineAt=function(e,t,i,r){if(r.onLineSegment){if(this.useCompactBuffers)var s=this.stride*e*2,n=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w,c=this.vbs[s+2]/65535*o-Math.PI,l=this.vbs[s+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),u=this.vbs[s+4]/32767*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y)*2;else{var h=this.stride*e;n=this.vbf[h],a=this.vbf[h+1],c=this.vbf[h+2]*o-Math.PI,l=this.vbf[h+3],u=2*this.vbf[h+4]}var d=n+l*Math.cos(c),p=a+l*Math.sin(c);r.onLineSegment(n,a,d,p,i,u)}},a.prototype.decodeCircularArcAt=function(e,t,i,r){if(r.onCircularArc){if(this.useCompactBuffers)var s=this.stride*e*2,n=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w,c=this.vbs[s+2]/65535*o,l=this.vbs[s+3]/65535*o,u=this.vbs[s+5]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var h=this.stride*e;n=this.vbf[h],a=this.vbf[h+1],c=this.vbf[h+2]*o,l=this.vbf[h+3]*o,u=this.vbf[h+5]}r.onCircularArc(n,a,c,l,u,i)}},a.prototype.decodeEllipticalArcAt=function(e,t,i,r){if(r.onEllipticalArc){var s=this.stride*e,n=this.vbf[s],a=this.vbf[s+1],c=this.vbf[s+2]*o,l=this.vbf[s+3]*o,u=this.vbf[s+5],h=this.vbf[s+10],d=this.vbf[s+11];r.onEllipticalArc(n,a,c,l,u,h,d,i)}},a.prototype.decodeTexQuadAt=function(e,t,i,r){if(r.onTexQuad){if(this.useCompactBuffers)var s=this.stride*e*2,n=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w,c=this.vbs[s+2]/65535*o,l=this.vbs[s+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),u=this.vbs[s+4]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var h=this.stride*e;n=this.vbf[h],a=this.vbf[h+1],c=this.vbf[h+2]*o,l=this.vbf[h+3],u=this.vbf[h+4]}r.onTexQuad(n,a,l,u,c,i)}},a.prototype.decodeOneTriangleAt=function(e,t,i,r){if(r.onOneTriangle){if(this.useCompactBuffers)var s=this.stride*e*2,n=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,o=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w,a=this.useCompactBuffers.x*this.vbs[s+2]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[s+3]/65535+this.useCompactBuffers.w,l=this.useCompactBuffers.x*this.vbs[s+4]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[s+5]/65535+this.useCompactBuffers.w;else{var h=this.stride*e;n=this.vbf[h],o=this.vbf[h+1],a=this.vbf[h+2],c=this.vbf[h+3],l=this.vbf[h+4],u=this.vbf[h+5]}r.onOneTriangle(n,o,a,c,l,u,i)}},a.prototype.decodeTriangleIndexed=function(e,t,i,r,s,n){if(n.onOneTriangle){if(this.useCompactBuffers){var o=this.stride*e*2,a=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w;o=this.stride*t*2;var l=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w;o=this.stride*i*2;var h=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,d=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w}else{var p=this.stride*e;a=this.vbf[p],c=this.vbf[p+1];p=this.stride*t;l=this.vbf[p],u=this.vbf[p+1];p=this.stride*i;h=this.vbf[p],d=this.vbf[p+1]}n.onOneTriangle(a,c,l,u,h,d,s)}},a.prototype.enumGeomsForObject=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var r=this.getVertexFlagsAt(i)>>8&255,s=this.getLayerIndexAt(i),n=this.getViewportIndexAt(i);if(a=this.getDbIdAt(i)===e)switch(r){case 1:this.decodeLineAt(i,s,n,t);break;case 2:this.decodeCircularArcAt(i,s,n,t);break;case 3:this.decodeEllipticalArcAt(i,s,n,t);break;case 4:this.decodeTexQuadAt(i,s,n,t);break;case 5:this.decodeOneTriangleAt(i,s,n,t)}i+=1}else for(i=0;i<this.ib.length;){var o=this.ib[i],a=(r=this.getVertexFlagsAt(o)>>8&255,s=this.getLayerIndexAt(o),n=this.getViewportIndexAt(o),this.getDbIdAt(o)===e);if(0===r)a&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],s,n,t),i+=3;else{if(a)switch(r){case 1:this.decodeLineAt(o,s,n,t);break;case 2:this.decodeCircularArcAt(o,s,n,t);break;case 3:this.decodeEllipticalArcAt(o,s,n,t);break;case 4:this.decodeTexQuadAt(o,s,n,t);break;case 5:this.decodeOneTriangleAt(o,s,n,t)}i+=6}}},a.prototype.enumGeomsForVisibleLayer=function(e,t){this.enumGeoms((function(t,i,r){return!e||0!==i&&-1!==e.indexOf(i)}),t)},a.prototype.enumGeoms=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var r=this.getVertexFlagsAt(i)>>8&255,s=this.getLayerIndexAt(i),n=this.getViewportIndexAt(i),o=this.getDbIdAt(i);if(c=!e||e(o,s,n))switch(r){case 1:this.decodeLineAt(i,s,n,t);break;case 2:this.decodeCircularArcAt(i,s,n,t);break;case 3:this.decodeEllipticalArcAt(i,s,n,t);break;case 4:this.decodeTexQuadAt(i,s,n,t);break;case 5:this.decodeOneTriangleAt(i,s,n,t)}i+=1}else for(i=0;i<this.ib.length;){var a=this.ib[i],c=(r=this.getVertexFlagsAt(a)>>8&255,s=this.getLayerIndexAt(a),n=this.getViewportIndexAt(a),o=this.getDbIdAt(a),!e||e(o,s,n));if(0===r)c&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],s,n,t),i+=3;else{if(c)switch(r){case 1:this.decodeLineAt(a,s,n,t);break;case 2:this.decodeCircularArcAt(a,s,n,t);break;case 3:this.decodeEllipticalArcAt(a,s,n,t);break;case 4:this.decodeTexQuadAt(a,s,n,t);break;case 5:this.decodeOneTriangleAt(a,s,n,t)}i+=6}}},c.prototype.onVertex=function(e,t,i){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},c.prototype.onLineSegment=function(e,t,i,r,s){this.onVertex(e,t),this.onVertex(i,r)},c.prototype.onCircularArc=function(e,t,i,r,s,n){this.onEllipticalArc(e,t,i,r,s,s,0,n)},c.prototype.onEllipticalArc=function(e,t,i,r,s,n,o,a){0==o?i<=0&&r>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*s,2*n,o,a):(this.point.x=e+Math.cos(i)*s,this.point.y=t+Math.sin(i)*n,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(r)*s,this.point.y=t+Math.sin(r)*n,this.bounds.expandByPoint(this.point),i>r&&(this.point.x=e+s,this.point.y=t,this.bounds.expandByPoint(this.point),i-=2*Math.PI),i<.5*Math.PI&&r>.5*Math.PI&&(this.point.x=e,this.point.y=t+n,this.bounds.expandByPoint(this.point)),i<Math.PI&&r>Math.PI&&(this.point.x=e-s,this.point.y=t,this.bounds.expandByPoint(this.point)),i<1.5*Math.PI&&r>1.5*Math.PI&&(this.point.x=e,this.point.y=t-n,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*s,2*n,o,a)},c.prototype.onTexQuad=function(e,t,i,r,s,o){var a=.5*i,c=.5*i;if(0==s)this.onVertex(e-a,t-c),this.onVertex(e+a,t+c);else{var l=new n.Matrix4,u=new n.Matrix4;l.makeRotationZ(s),u.makeTranslation(e,t,0),u.multiply(l);for(var h=0;h<4;h++)this.point.x=h%2==1?a:-a,this.point.y=h>=2?c:-c,this.point.applyMatrix4(u),this.bounds.expandByPoint(this.point)}},c.prototype.onOneTriangle=function(e,t,i,r,s,n,o){this.onVertex(e,t),this.onVertex(i,r),this.onVertex(s,n)};var l=i(79);function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,"Snapper",(function(){return T}));var h=Autodesk.Viewing.MeasureCommon,d=h.EPSILON,p=h.SnapType,v=h.SnapResult,f=Autodesk.Viewing;function g(e,t){return Math.abs(e-t)<=.001}function y(e,t){return Math.abs(e.x-t.x)<=.001&&Math.abs(e.y-t.y)<=.001&&Math.abs(e.z-t.z)<=.001}function m(e,t,i){var r,s,n=new THREE.Vector3,o=new THREE.Vector3;return n.subVectors(t,e),o.subVectors(i,t),s=n.dot(o),n.subVectors(i,t),(s=-s/n.dot(n))<0?r=e.distanceTo(t):s>1?r=e.distanceTo(i):(n.subVectors(e,t),o.subVectors(e,i),n.cross(o),o.subVectors(i,t),r=Math.sqrt(n.dot(n))/Math.sqrt(o.dot(o))),r}var E={Unknown:0,Line:1,CircularArc:2,EllipticalArc:3},b=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=E.Unknown,this.viewportId=t,this.distance=0,this.lineStart=null,this.lineEnd=null,this.radius=0,this.radiusX=0,this.radiusY=0,this.center=null,this.startAngle=0,this.endAngle=0}var t,i,r;return t=e,(i=[{key:"fromLine",value:function(e,t){return this.type=E.Line,this.lineStart=e.clone(),this.lineEnd=t.clone(),this}},{key:"fromCircularArc",value:function(e,t,i,r){return this.type=E.CircularArc,this.center=e.clone(),this.radius=t,this.start=i,this.end=r,this}},{key:"fromEllipticalArc",value:function(e,t,i,r,s){return this.type=E.EllipticalArc,this.center=e.clone(),this.radiusX=t,this.radiusY=i,this.start=r,this.end=s,this}},{key:"isLine",value:function(){return this.type===E.Line}},{key:"isCircularArc",value:function(){return this.type===E.CirularArc}},{key:"isEllipticalArc",value:function(){return this.type===E.EllipticalArc}},{key:"getIntersection",value:function(e,t){if(this.isLine()&&e.isLine())return Object(l.intersectLines)(this.lineStart,this.lineEnd,e.lineStart,e.lineEnd,!1,t)}}])&&u(t.prototype,i),r&&u(t,r),e}();function T(e,t){var i=new v,n=e;this.setGlobalManager(e.globalManager);var o,c=t||{};o=c.markupMode?["snapper-markup"]:["snapper"];var u=!1,h=Number.MAX_VALUE,f=null,E=!1,T=!1,w=!1,x=null,A=!1;this.indicator=new r.SnapperIndicator(e,this),this.markupMode=c.markupMode,this.renderSnappedGeometry=c.renderSnappedGeometry,this.renderSnappedTopology=c.renderSnappedTopology,this.detectRadiusInPixels=Object(s.a)()?50:10,this.isActive=function(){return u},this.getNames=function(){return o},this.getName=function(){return o[0]},this.getPriority=function(){return 60},this.activate=function(){u=!0,this.indicator||(this.indicator=new r.SnapperIndicator(e,this))},this.deactivate=function(){u=!1,this.indicator&&(this.indicator.destroy(),this.indicator=null)},this.copyResults=function(e){i.copyTo(e)},this.getEdge=function(){return i.geomEdge},this.getVertex=function(){return i.geomVertex},this.getGeometry=function(){return i.getGeometry()},this.getGeometryType=function(){return i.geomType},this.getIntersectPoint=function(){return i.intersectPoint},this.getSnapResult=function(){return i},this.isSnapped=function(){return w},this.clearSnapped=function(){i.clear(),w=!1},this.setViewportId=function(e){x=e},this.setSnapToPixel=function(e){A=e},this.getSnapToPixel=function(){return A},this.snapping3D=function(e){if(i.snapNode=e.dbId,i.intersectPoint=e.intersectPoint,i.modelId=e.model?e.model.id:null,e.model){var t,r=e.face;t=e.fragId&&void 0!==e.fragId.length?e.fragId:[e.fragId],i.hasTopology=e.model.hasTopology(),i.hasTopology?this.snapping3DwithTopology(r,t,e.model):this.snapping3DtoMesh(r,t,e.model)}},this.snapping3DwithTopology=function(e,t,r){i.snapNode&&(t=[],r.getData().instanceTree.enumNodeFragments(i.snapNode,(function(e){t.push(e)}),!0)),i.geomFace=i.geomEdge=i.geomVertex=null,h=Number.MAX_VALUE;for(var s=0;s<t.length;++s){var o=t[s],a=n.impl.getRenderProxy(r,o),l=a.geometry,u=r.getTopoIndex(o),d=r.getTopology(u),v=d.faces,g=d.edges;if(!i.geomFace){i.geomFace=this.faceSnappingWithTopology(e,l,v,a),i.geomFace&&(i.geomFace.fragId=o);var y=(new THREE.Matrix3).getNormalMatrix(a.matrixWorld);i.faceNormal=e.normal.applyMatrix3(y).normalize()}this.edgeSnappingWithTopology(i.intersectPoint,l,g,a)}if(i.geomVertex=this.vertexSnappingWithTopology(i.geomEdge,i.intersectPoint),i.geomFace){if(i.radius=this.setDetectRadius(i.intersectPoint),(c.forceSnapVertices||f<i.radius)&&i.geomVertex)i.geomType=p.SNAP_VERTEX;else if((c.forceSnapEdges||h<i.radius)&&i.geomEdge){var m=this.edgeIsCircle(i.geomEdge);m?(i.circularArcCenter=m,i.circularArcRadius=m.distanceTo(i.geomEdge.vertices[0]),i.geomEdge.center=i.circularArcCenter,i.geomEdge.radius=i.circularArcRadius,i.geomType=p.SNAP_CIRCULARARC):this.edgeIsCurved(i.geomEdge)?i.geomType=p.SNAP_CURVEDEDGE:i.geomType=p.SNAP_EDGE}else this.faceIsCurved(i.geomFace)?i.geomType=p.SNAP_CURVEDFACE:i.geomType=p.SNAP_FACE;w=!0}},this.snapping3DtoMesh=function(e,t,r){for(var s=0;s<t.length;++s){var o=t[s],a=n.impl.getRenderProxy(r,o),l=a.geometry;if(e instanceof THREE.Face3&&(i.geomFace=this.faceSnapping(e,l)),i.geomFace){i.geomFace.applyMatrix(a.matrixWorld),i.geomEdge=this.edgeSnapping(i.geomFace,i.intersectPoint),i.geomVertex=this.vertexSnapping(i.geomEdge,i.intersectPoint);var u=(new THREE.Matrix3).getNormalMatrix(a.matrixWorld);i.faceNormal=e.normal.applyMatrix3(u).normalize(),i.radius=this.setDetectRadius(i.intersectPoint),c.forceSnapVertices||f<i.radius?i.geomType=p.SNAP_VERTEX:c.forceSnapEdges||h<i.radius?i.geomType=p.SNAP_EDGE:i.geomType=p.SNAP_FACE,w=!0;break}}},this.faceSnappingWithTopology=function(e,t,i,r){var s=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Geometry,c=t.attributes;if(void 0!==c.index){for(var l=t.vb?t.vb:c.position.array,u=t.vb?t.vbstride:3,h=0;h<i.length;h++){for(var d=i[h].indexList,p=i[h].id,v=0;v<d.length;v+=3)if(e.a===d[v]){if(e.b===d[v+1]&&e.c===d[v+2]||e.b===d[v+2]&&e.c===d[v+1])break}else if(e.a===d[v+1]){if(e.b===d[v]&&e.c===d[v+2]||e.b===d[v+2]&&e.c===d[v])break}else if(e.a===d[v+2]&&(e.b===d[v]&&e.c===d[v+1]||e.b===d[v+1]&&e.c===d[v]))break;if(v<d.length)break}if(h<i.length)for(v=0;v<d.length;v+=3){s.set(l[d[v]*u],l[d[v]*u+1],l[d[v]*u+2]),n.set(l[d[v+1]*u],l[d[v+1]*u+1],l[d[v+1]*u+2]),o.set(l[d[v+2]*u],l[d[v+2]*u+1],l[d[v+2]*u+2]);var f=a.vertices.length;a.vertices.push(s.clone()),a.vertices.push(n.clone()),a.vertices.push(o.clone()),a.faces.push(new THREE.Face3(f,f+1,f+2))}}return a.vertices.length>0?(a.faceId=p,a.applyMatrix(r.matrixWorld),a):null},this.faceSnapping=function(e,t){var i=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,n=new THREE.Geometry,o=t.attributes,a=o.index&&(o.index.array||t.ib),c=t.vb?t.vb:o.position.array,l=t.vb?t.vbstride:3,u=t.offsets;u&&0!==u.length||(u=[{start:0,count:a?a.length:c.length,index:0}]);for(var h=0;h<u.length;++h)for(var d=u[h].start,p=u[h].count,v=u[h].index,f=d;f<d+p;f+=3){var m=v+(a?a[f]:f),E=v+(a?a[f+1]:f+1),b=v+(a?a[f+2]:f+2);i.set(c[m*l],c[m*l+1],c[m*l+2]),r.set(c[E*l],c[E*l+1],c[E*l+2]),s.set(c[b*l],c[b*l+1],c[b*l+2]);var T=THREE.Triangle.normal(i,r,s),w=new THREE.Vector3;if(w.set(c[e.a*l],c[e.a*l+1],c[e.a*l+2]),y(T,e.normal)&&g(T.dot(i),e.normal.dot(w))){var x=n.vertices.length;n.vertices.push(i.clone()),n.vertices.push(r.clone()),n.vertices.push(s.clone()),n.faces.push(new THREE.Face3(x,x+1,x+2))}}return n.vertices.length>0?this.getTrianglesOnSameFace(n,e,c,l):null},this.getTrianglesOnSameFace=function(e,t,i,r){var s=!1,n=e.vertices.slice(),o=new THREE.Vector3;o.set(i[t.a*r],i[t.a*r+1],i[t.a*r+2]);var a=new THREE.Vector3;a.set(i[t.b*r],i[t.b*r+1],i[t.b*r+2]);var c=new THREE.Vector3;c.set(i[t.c*r],i[t.c*r+1],i[t.c*r+2]);var l=new THREE.Geometry;l.vertices.push(o),l.vertices.push(a),l.vertices.push(c),l.faces.push(new THREE.Face3(0,1,2));var u=[];do{u=[];for(var h=0;h<n.length;h+=3)if(n[h].equals(o)&&n[h+1].equals(a)&&n[h+2].equals(c))s=!0,u.push(h);else for(var d=0;d<l.vertices.length;d+=3)if(this.trianglesSharedEdge(n[h],n[h+1],n[h+2],l.vertices[d],l.vertices[d+1],l.vertices[d+2])){var p=l.vertices.length;l.vertices.push(n[h].clone()),l.vertices.push(n[h+1].clone()),l.vertices.push(n[h+2].clone()),l.faces.push(new THREE.Face3(p,p+1,p+2)),u.push(h);break}for(var v=u.length-1;v>=0;--v)n.splice(u[v],3)}while(u.length>0);return s?l:null},this.trianglesSharedEdge=function(e,t,i,r,s,n){var o=!1,a=!1,c=!1;return(e.equals(r)||e.equals(s)||e.equals(n))&&(o=!0),(t.equals(r)||t.equals(s)||t.equals(n))&&(a=!0),(i.equals(r)||i.equals(s)||i.equals(n))&&(c=!0),!!(o&a||o&c||a&c)},this.edgeSnappingWithTopology=function(e,t,r,s){var n,o=new THREE.Geometry,a=Number.MAX_VALUE,c=new THREE.Vector3,l=new THREE.Vector3,u=t.attributes;if(void 0!==u.index&&null!=r){for(var d=t.vb?t.vb:u.position.array,p=t.vb?t.vbstride:3,v=0;v<r.length;v++)for(var f=r[v].indexList,g=0;g<f.length-1;g++){c.set(d[f[g]*p],d[f[g]*p+1],d[f[g]*p+2]),l.set(d[f[g+1]*p],d[f[g+1]*p+1],d[f[g+1]*p+2]),c.applyMatrix4(s.matrixWorld),l.applyMatrix4(s.matrixWorld);var y=m(e,c,l);y<a&&(a=y,n=v)}if(n){f=r[n].indexList;for(var E=0;E<f.length-1;E++)o.vertices.push(new THREE.Vector3(d[f[E]*p],d[f[E]*p+1],d[f[E]*p+2])),o.vertices.push(new THREE.Vector3(d[f[E+1]*p],d[f[E+1]*p+1],d[f[E+1]*p+2]))}}h>=a&&o.vertices.length>0&&(h=a,o.applyMatrix(s.matrixWorld),i.geomEdge=o)},this.edgeSnapping=function(e,t){for(var i=new THREE.Geometry,r=!0,s=!0,n=!0,o=0;o<e.vertices.length;o+=3){for(var a=0;a<e.vertices.length;a+=3)o!==a&&((e.vertices[o].equals(e.vertices[a])||e.vertices[o].equals(e.vertices[a+1])||e.vertices[o].equals(e.vertices[a+2]))&&(e.vertices[o+1].equals(e.vertices[a])||e.vertices[o+1].equals(e.vertices[a+1])||e.vertices[o+1].equals(e.vertices[a+2]))&&(r=!1),(e.vertices[o].equals(e.vertices[a])||e.vertices[o].equals(e.vertices[a+1])||e.vertices[o].equals(e.vertices[a+2]))&&(e.vertices[o+2].equals(e.vertices[a])||e.vertices[o+2].equals(e.vertices[a+1])||e.vertices[o+2].equals(e.vertices[a+2]))&&(s=!1),(e.vertices[o+1].equals(e.vertices[a])||e.vertices[o+1].equals(e.vertices[a+1])||e.vertices[o+1].equals(e.vertices[a+2]))&&(e.vertices[o+2].equals(e.vertices[a])||e.vertices[o+2].equals(e.vertices[a+1])||e.vertices[o+2].equals(e.vertices[a+2]))&&(n=!1));r&&(i.vertices.push(e.vertices[o].clone()),i.vertices.push(e.vertices[o+1].clone())),s&&(i.vertices.push(e.vertices[o].clone()),i.vertices.push(e.vertices[o+2].clone())),n&&(i.vertices.push(e.vertices[o+1].clone()),i.vertices.push(e.vertices[o+2].clone())),r=!0,s=!0,n=!0}for(var c,l=new THREE.Geometry,u=Number.MAX_VALUE,d=0;d<i.vertices.length;d+=2){var p=m(t,i.vertices[d],i.vertices[d+1]);p<u&&(u=p,c=d)}return l.vertices.push(i.vertices[c].clone()),l.vertices.push(i.vertices[c+1].clone()),l.vertices=this.getConnectedLineSegmentsOnSameLine(i,l.vertices),h=u,l},this.getConnectedLineSegmentsOnSameLine=function(e,t){var i,r,s=e.vertices.slice(),n=t[0],o=t[1],a=[];do{a=[];for(var c=0;c<s.length;c+=2)if(!s[c].equals(n)||!s[c+1].equals(o))for(var l=0;l<t.length;l+=2)if(s[c].equals(t[l])||s[c+1].equals(t[l])||s[c].equals(t[l+1])||s[c+1].equals(t[l+1])){var u=new THREE.Vector3,h=new THREE.Vector3;if(u.subVectors(t[l],t[l+1]),u.normalize(),h.subVectors(s[c],s[c+1]),h.normalize(),y(u,h)||(i=u,r=h,Math.abs(i.x+r.x)<=.001&&Math.abs(i.y+r.y)<=.001&&Math.abs(i.z+r.z)<=.001)){a.push(c);break}}for(var d=a.length-1;d>=0;--d)t.push(s[a[d]]),t.push(s[a[d]+1]),s.splice(a[d],2)}while(a.length>0);return t},this.vertexSnappingWithTopology=function(e,t){var i=Number.MAX_VALUE,r=new THREE.Vector3;if(e&&e.vertices.length>1){var s=t.distanceTo(e.vertices[0]),n=t.distanceTo(e.vertices[e.vertices.length-1]);s<=n?(i=s,r=e.vertices[0].clone()):(i=n,r=e.vertices[e.vertices.length-1].clone())}return f=i,r},this.vertexSnapping=function(e,t){for(var i=Number.MAX_VALUE,r=new THREE.Vector3,s=0;s<e.vertices.length;++s){var n=t.distanceTo(e.vertices[s]);n<i-.001&&(i=n,r=e.vertices[s].clone())}return f=i,r},this.edgeIsCircle=function(e){var t=e.vertices;if(t.length<8)return!1;if(t[0].equals(t[t.length-1])){for(var i=new THREE.Vector3(0,0,0),r=0;r<t.length;r+=2)i.add(t[r]);i.divideScalar(t.length/2);var s=i.distanceTo(t[0]);for(r=0;r<t.length;r+=2)if(!(Math.abs(i.distanceTo(t[r])-s)<=.001))return!1;return i}return!1},this.edgeIsCurved=function(e){var t=e.vertices;if(t.length<=2)return!1;if(t[0].equals(t[t.length-1]))return!0;var i=new THREE.Vector3;i.subVectors(t[0],t[1]);for(var r=new THREE.Vector3,s=2;s<t.length;s+=2)if(r.subVectors(t[s],t[s+1]),!y(i,r))return!0;return!1},this.faceIsCurved=function(e){var t=e.vertices,i=e.faces;if(i.length<=1)return!1;for(var r=THREE.Triangle.normal(t[i[0].a],t[i[0].b],t[i[0].c]),s=t[i[0].a],n=1;n<i.length;n++){var o=THREE.Triangle.normal(t[i[n].a],t[i[n].b],t[i[n].c]),a=t[i[n].a];if(!y(r,o)||!g(r.dot(s),o.dot(a)))return!0}return!1},this.angleVector2=function(e){return e.x>0&&e.y>=0?Math.atan(e.y/e.x):e.x>=0&&e.y<0?Math.atan(e.y/e.x)+2*Math.PI:e.x<0&&e.y<=0||e.x<=0&&e.y>0?Math.atan(e.y/e.x)+Math.PI:null};function V(e,t,i){this.viewer=e,this.snapper=t,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=i,this.snapCandidates=[]}V.prototype.onLineSegment=function(e,t,i,r,s){var n=this.snapper.getIntersectPoint(),o=this.lineGeom.vertices,a=new THREE.Vector3(e,t,n.z),c=new THREE.Vector3(i,r,n.z),l=m(n,a,c);l>this.detectRadius||(this.snapCandidates.push(new b(s,l).fromLine(a,c)),l<this.minDist&&(o.splice(0,2,a,c),this.minDist=l,this.vpIdLine=s))},V.prototype.onCircularArc=function(e,t,i,r,s,n){var o=this.snapper.getIntersectPoint(),a=new THREE.Vector2(o.x,o.y),c=new THREE.Vector2(e,t);a.sub(c);var u=Object(l.nearestPointOnCircularArc)(o,c,s,i,r),h=u.distanceTo(o);if(this.snapCandidates.push(new b(n,h).fromCircularArc(c,s,i,r)),!(h>this.detectRadius)){var d=this.snapper.angleVector2(a);if(r>i&&d>=i&&d<=r)var p=new THREE.CircleGeometry(s,100,i,r-i);else{if(!(r<i&&(d>=i||d<=r)))return;p=new THREE.CircleGeometry(s,100,i,2*Math.PI-i+r)}p.vertices.splice(0,1),p.applyMatrix((new THREE.Matrix4).makeTranslation(e,t,o.z)),this.circularArc=p,this.circularArcCenter=new THREE.Vector3(e,t,o.z),this.circularArcRadius=s,this.snapPoint=new THREE.Vector3(u.x,u.y,o.z),this.vpIdCircular=n}},V.prototype.onEllipticalArc=function(e,t,i,r,s,n,o,a){var c=this.snapper.getIntersectPoint(),l=new THREE.Vector2(c.x,c.y),u=s-this.detectRadius,h=n-this.detectRadius,d=s+this.detectRadius,p=n+this.detectRadius,v=(l.x-e)*(l.x-e)/(u*u)+(l.y-t)*(l.y-t)/(h*h),f=(l.x-e)*(l.x-e)/(d*d)+(l.y-t)*(l.y-t)/(p*p),y=new THREE.Vector2(e,t);l.sub(y),l.x*=n,l.y*=s;var m=this.snapper.angleVector2(l);if(r>2*Math.PI&&(r=2*Math.PI),v>=1&&f<=1&&(r>i&&m>=i&&m<=r||r<i&&(m>=i||m<=r))){var E=function(e,t,i,r,s,n,o){for(var a=new THREE.Geometry,c=0;c<o;c++){var l=new THREE.Vector3(0,0,0),u=c/(o-1);Autodesk.Extensions.CompGeom.getEllipseArcPoint(u,e,t,i,r,s,n,0,l),a.vertices.push(l)}return a}(e,t,s,n,i,r,50);g(r-i,2*Math.PI)||E.vertices.pop(),E.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,c.z));var T=nearestVertexInVertexToEdge(c,E),w=THREE.Vector2.prototype.distanceTo.call(T,c),x=new THREE.Vector2(e,t);this.snapCandidates.push(new b(a,w).makeEllipticalArc(x,s,n,i,r)),this.ellipticalArc=E,this.ellipticalArcCenter=new THREE.Vector3(e,t,c.z),this.vpIdElliptical=a}},this.snapping2D=function(e){if(e){var t=e.intersectPoint,r=e.fragId;if(void 0!==r){if(Array.isArray(r)||(r=[r]),i.modelId=e.model?e.model.id:null,i.hasTopology=!1,i.intersectPoint=t,i.radius=this.setDetectRadius(t),!(null!=n.model.getFragmentList()))return w=!0,i.geomType=p.SNAP_VERTEX,void(i.geomVertex=t);for(var s=new V(n,this,i.radius),o=0;o<r.length;++o){var c=n.impl.getRenderProxy(n.model,r[o]);if(c&&c.geometry)new a(c.geometry).enumGeomsForObject(n.model.reverseMapDbId(e.dbId),s)}this.finishSnapping2D(s,t),!w&&A&&(w=!0,i.geomType=p.RASTER_PIXEL,i.geomVertex=t)}}},this.snapping2DOverlay=function(e,t,r,s){i.hasTopology=!1,i.intersectPoint=e,i.radius=s||this.setDetectRadius(e);for(var o=new V(n,this,i.radius),c=0;c<t.length;c++){new a(t[c].geometry).enumGeoms(r,o)}this.finishSnapping2D(o,e)},this.snapping2DWithSegmentEnum=function(e,t){i.hasTopology=!1,i.intersectPoint=e,i.radius=this.setDetectRadius(e);var r=new V(n,this,i.radius);t(e.x-i.radius,e.y-i.radius,e.x+i.radius,e.y+i.radius,r),this.finishSnapping2D(r,e)},this.finishSnapping2D=function(e,t){if(null!==x){e.snapCandidates=e.snapCandidates.filter((function(e){return e.viewportId===x}))}var r=function(e,t,i){if(e.sort((function(e,t){return e.distance-t.distance})),e.length<2)return null;for(var r={viewportId:e[0].viewportId,snapPoint:new THREE.Vector3(0,0,t.z)},s=e[0],n=1;n<e.length;n++){var o=e[n];if(s.getIntersection(o,r.snapPoint))if(THREE.Vector2.prototype.distanceTo.call(r.snapPoint,t)<i)return r}return null}(e.snapCandidates,t,e.detectRadius);if(r)return i.viewportIndex2d=r.viewportId,i.snapPoint=r.snapPoint,i.geomType=p.SNAP_INTERSECTION,i.geomVertex=r.snapPoint,void(w=!0);if(e.circularArc){if(i.viewportIndex2d=e.vpIdCircular,i.snapPoint=e.snapPoint,null!==x&&x!==i.viewportIndex2d)return;t.distanceTo(e.circularArc.vertices[0])<i.radius?(i.geomVertex=e.circularArc.vertices[0],i.geomType=p.SNAP_VERTEX):t.distanceTo(e.circularArc.vertices[e.circularArc.vertices.length-1])<i.radius?(i.geomVertex=e.circularArc.vertices[e.circularArc.vertices.length-1],i.geomType=p.SNAP_VERTEX):(this.lineStripToPieces(e.circularArc),i.geomEdge=e.circularArc,i.circularArcCenter=e.circularArcCenter,i.circularArcRadius=e.circularArcRadius,i.geomType=p.SNAP_CIRCULARARC),w=!0}else if(e.ellipticalArc){if(i.viewportIndex2d=e.vpIdElliptical,null!==x&&x!==i.viewportIndex2d)return;t.distanceTo(e.ellipticalArc.vertices[0])<i.radius?(i.geomVertex=e.ellipticalArc.vertices[0],i.geomType=p.SNAP_VERTEX):t.distanceTo(e.ellipticalArc.vertices[e.ellipticalArc.vertices.length-1])<i.radius?(i.geomVertex=e.ellipticalArc.vertices[e.ellipticalArc.vertices.length-1],i.geomType=p.SNAP_VERTEX):(this.lineStripToPieces(e.ellipticalArc),i.geomEdge=e.ellipticalArc,i.circularArcCenter=e.ellipticalArcCenter,i.circularArcRadius=null,i.geomType=p.SNAP_CIRCULARARC),w=!0}else if(e.lineGeom.vertices.length){if(i.viewportIndex2d=e.vpIdLine,null!==x&&x!==i.viewportIndex2d)return;if(i.geomEdge=e.lineGeom,this.markupMode){var s=e.lineGeom.vertices[0],n=e.lineGeom.vertices[1],o=new THREE.Vector3;o.addVectors(s,n),o.divideScalar(2);var a=t.distanceTo(o),l=t.distanceTo(s),u=t.distanceTo(n);i.geomEdge=e.lineGeom,a<i.radius?(i.geomVertex=o,i.geomType=p.SNAP_VERTEX):l<i.radius?(i.geomVertex=s,i.geomType=p.SNAP_VERTEX):u<i.radius?(i.geomVertex=n,i.geomType=p.SNAP_VERTEX):i.geomType=p.SNAP_EDGE,e.lineGeom.vertices[0].distanceTo(e.lineGeom.vertices[1])<d&&(i.geomType=p.SNAP_CIRCLE_CENTER)}else t.distanceTo(e.lineGeom.vertices[0])<i.radius?(e.lineGeom.vertices[0].distanceTo(e.lineGeom.vertices[1])<d?i.geomType=p.SNAP_CIRCLE_CENTER:i.geomType=p.SNAP_VERTEX,i.geomVertex=e.lineGeom.vertices[0]):c.forceSnapVertices||t.distanceTo(e.lineGeom.vertices[1])<i.radius?(i.geomVertex=e.lineGeom.vertices[1],i.geomType=p.SNAP_VERTEX):i.geomType=p.SNAP_EDGE;w=!0}},this.snappingLeaflet=function(e){if(e){var t=e.intersectPoint;i.intersectPoint=t,i.hasTopology=!1,i.radius=this.setDetectRadius(t),i.geomType=p.RASTER_PIXEL,i.geomVertex=t,w=!0}},this.snapMidpoint=function(){if(i.isMidpoint=!1,w&&i.geomType===p.SNAP_EDGE){var e=i.geomEdge,t=e.vertices[0],r=e.vertices[1],s=new THREE.Vector3((t.x+r.x)/2,(t.y+r.y)/2,(t.z+r.z)/2);i.intersectPoint.distanceTo(s)<2*i.radius&&(i.geomVertex=s,i.geomType=p.SNAP_MIDPOINT)}},this.setPerpendicular=function(e){i.isPerpendicular=e},this.lineStripToPieces=function(e){for(var t=e.vertices,i=t.length-2;i>0;i--)t.splice(i,0,t[i])},this.setDetectRadius=function(e){var t=n.navigation,i=t.getCamera(),r=t.getPosition(),s=e.clone(),o=i.isPerspective?s.sub(r).length():t.getEyeVector().length(),a=t.getVerticalFov(),c=2*o*Math.tan(THREE.Math.degToRad(.5*a)),l=t.getScreenViewport(),u=this.getWindow().devicePixelRatio||1;return this.detectRadiusInPixels*c/(l.height*u)},this.handleButtonDown=function(e,t){return E=!0,!1},this.handleButtonUp=function(e,t){return E=!1,!1},this.handleMouseMove=function(e){return E||this.onMouseMove({x:e.canvasX,y:e.canvasY}),!1},this.handleSingleTap=function(e){return this.handleMouseMove(e)},this.handlePressHold=function(e){if(Object(s.a)())switch(e.type){case"press":T=!0,this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"pressup":this.onMouseMove({x:e.canvasX,y:e.canvasY}),T=!1}return!1},this.handleGesture=function(e){if(Object(s.a)()&&T)switch(e.type){case"dragstart":case"dragmove":this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"dragend":this.onMouseMove({x:e.canvasX,y:e.canvasY}),T=!1}return!1},this.onMouseDown=function(e){return this.onMouseMove(e)},this.onMouseMove=function(e){this.clearSnapped();var t=n.impl.snappingHitTest(e.x,e.y,!1);if(!t&&A){var i=n.impl.clientToViewport(e.x,e.y);t={intersectPoint:n.impl.intersectGroundViewport(i)}}return!(!t||!t.intersectPoint)&&(t.face?this.snapping3D(t):t.dbId||0===t.dbId?this.snapping2D(t):this.snappingLeaflet(t),this.snapMidpoint(),!0)}}f.GlobalManagerMixin.call(T.prototype)},79:function(e,t,i){"use strict";i.r(t),i.d(t,"nearestPointOnCircularArc",(function(){return r})),i.d(t,"intersectLines",(function(){return s}));var r=function(e,t,i,r,s,n){var o=(n=n||new THREE.Vector2).copy(e).sub(t).normalize(),a=Math.atan2(o.y,o.x);if(Autodesk.Extensions.CompGeom.angleInsideArc(a,r,s))return o.multiplyScalar(i).add(t);var c=Autodesk.Extensions.CompGeom.getEllipsePoint(r,t.x,t.y,i,i),l=Autodesk.Extensions.CompGeom.getEllipsePoint(s,t.x,t.y,i,i),u=c.distanceToSquared(e)<=l.distanceToSquared(e);return n.copy(u?c:l),n},s=function(e,t,i,r,s,n){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e-5,a=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y);if(Math.abs(a)<o)return null;var c=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x);if(c/=a,s){var l=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x);if(l/=a,c<0||c>1||l<0||l>1)return null}return(n=n||new THREE.Vector2).x=e.x+c*(t.x-e.x),n.y=e.y+c*(t.y-e.y),n}},80:function(e,t,i){"use strict";i.r(t),i.d(t,"SnapperIndicator",(function(){return u}));var r=Autodesk.Viewing.MeasureCommon,s=r.isEqualVectors,n=r.EPSILON,o=r.SnapType,a="MeasureTool-snapper-geometries",c="MeasureTool-snapper-indicator",l=null;function u(e,t){this.viewer=e,this.snapper=t,this.overlayType=0,this.previewsIntersectPoint=null,this.viewer.impl.createOverlayScene(a),this.viewer.impl.createOverlayScene(c),this.geometryMaterial=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),this.indicatorMaterial=new THREE.MeshBasicMaterial({color:16742144,ambient:16742144,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}u.prototype.constructor=u;var h=u.prototype;h.render=function(){var e=this.snapper.getSnapResult();s(this.previewsIntersectPoint,e.intersectPoint,n)||this.clearOverlay(a),this.clearOverlay(c),e.isEmpty()||((this.snapper.renderSnappedGeometry||e.hasTopology&&this.snapper.renderSnappedTopology)&&this.renderGeometry(e),this.renderIndicator(e),this.previewsIntersectPoint=e.intersectPoint.clone())},h.removeOverlay=function(e){this.viewer.impl.clearOverlay(e),this.viewer.impl.removeOverlayScene(e)},h.clearOverlay=function(e){this.removeOverlay(e),this.viewer.impl.createOverlayScene(e)},h.clearOverlays=function(){this.removeOverlay(a),this.viewer.impl.createOverlayScene(a),this.removeOverlay(c),this.viewer.impl.createOverlayScene(c),this.previewsIntersectPoint=null},h.addOverlay=function(e,t){this.viewer.impl.addOverlay(e,t)},h.drawFace=function(e,t,i){var r=new THREE.Mesh(e,t,!0);i===a&&(this.overlayType=1),this.addOverlay(i,r)},h.cylinderMesh=function(e,t,i,r){var s=(new THREE.Vector3).subVectors(t,e),n=new THREE.Matrix4;n.lookAt(e,t,(new THREE.Object3D).up),n.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-s.length(),0,0,0,0,0,1)),r=r||.5;var o=new THREE.CylinderGeometry(r,r,1,8,1,!0),a=new THREE.Mesh(o,i);return o=null,a.applyMatrix(n),a.position.x=(t.x+e.x)/2,a.position.y=(t.y+e.y)/2,a.position.z=(t.z+e.z)/2,a},h.renderGeometry=function(e){if(!s(this.previewsIntersectPoint,e.intersectPoint,n))switch(e.geomType){case o.SNAP_VERTEX:o.RASTER_PIXEL,this.drawPoint(e.geomVertex,this.geometryMaterial,a);break;case o.SNAP_EDGE:case o.SNAP_CURVEDEDGE:case o.SNAP_CIRCULARARC:case o.SNAP_MIDPOINT:this.drawLine(e.geomEdge,this.geometryMaterial,.3,a);break;case o.SNAP_FACE:case o.SNAP_CURVEDFACE:this.drawFace(e.geomFace,this.geometryMaterial,a)}},h.renderVertexIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),s=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),n=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),o=new THREE.Geometry,a=new THREE.Vector3;a.addVectors(t,s),a.addVectors(a,n),o.vertices[0]=a.clone(),a.subVectors(t,s),a.addVectors(a,n),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.addVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),a.subVectors(t,s),a.subVectors(a,n),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.subVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),a.subVectors(t,s),a.addVectors(a,n),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.addVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),a.addVectors(t,s),a.addVectors(a,n),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c)},h.renderMidpointIndicator=function(e){var t=e.geomVertex,i=1.2*this.setScale(t),r=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),s=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),n=new THREE.Geometry,o=new THREE.Vector3;o.addVectors(t,r),o.subVectors(o,s),n.vertices[0]=o.clone(),o.subVectors(t,r),o.subVectors(o,s),n.vertices[1]=o.clone(),this.drawLine(n,this.indicatorMaterial,.2,c),o.subVectors(t,r),o.subVectors(o,s),n.vertices[0]=o.clone(),o.addVectors(t,s),n.vertices[1]=o.clone(),this.drawLine(n,this.indicatorMaterial,.2,c),o.addVectors(t,r),o.subVectors(o,s),n.vertices[0]=o.clone(),o.addVectors(t,s),n.vertices[1]=o.clone(),this.drawLine(n,this.indicatorMaterial,.2,c)},h.renderEdgeIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),s=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),n=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),o=new THREE.Geometry,a=new THREE.Vector3;a.addVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),o.vertices[1]=t.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.subVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),o.vertices[1]=t.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.addVectors(t,n),o.vertices[0]=a.clone(),o.vertices[1]=t.clone(),this.drawLine(o,this.indicatorMaterial,.2,c)},h.renderCircleIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer);this.drawCircle(t,this.indicatorMaterial,c)},h.renderPerpendicular=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),s=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),n=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),o=new THREE.Geometry,a=new THREE.Vector3;o.vertices[0]=t.clone(),a.subVectors(t,s),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.addVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),a.subVectors(t,s),a.subVectors(a,n),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.subVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),a.subVectors(t,s),a.addVectors(a,n),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),o.vertices[0]=t.clone(),a.subVectors(t,n),o.vertices[1]=a.clone(),this.drawLine(o,this.indicatorMaterial,.2,c)},h.renderPixelIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),s=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),n=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),o=new THREE.Geometry,a=new THREE.Vector3;a.subVectors(t,s),a.addVectors(a,n),o.vertices[0]=a.clone(),o.vertices[1]=t.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.addVectors(t,s),a.addVectors(a,n),o.vertices[0]=a.clone(),o.vertices[1]=t.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.addVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),o.vertices[1]=t.clone(),this.drawLine(o,this.indicatorMaterial,.2,c),a.subVectors(t,s),a.subVectors(a,n),o.vertices[0]=a.clone(),o.vertices[1]=t.clone(),this.drawLine(o,this.indicatorMaterial,.2,c)},h.renderIndicator=function(e){if(e.isPerpendicular)this.renderPerpendicular(e);else switch(e.geomType){case o.SNAP_VERTEX:case o.SNAP_INTERSECTION:this.renderVertexIndicator(e);break;case o.SNAP_MIDPOINT:this.renderMidpointIndicator(e);break;case o.SNAP_CIRCLE_CENTER:this.renderCircleIndicator(e);break;case o.SNAP_EDGE:case o.SNAP_CURVEDEDGE:this.renderEdgeIndicator(e);break;case o.SNAP_CIRCULARARC:this.viewer.model.is2d()?this.renderVertexIndicator(e):this.renderCircleIndicator(e);break;case o.SNAP_FACE:case o.SNAP_CURVEDFACE:this.renderVertexIndicator(e);break;case o.RASTER_PIXEL:this.renderPixelIndicator(e)}},h.drawLine=function(e,t,i,r){r===a&&(this.overlayType=2);for(var s=0;s<e.vertices.length;s+=2){var n=this.cylinderMesh(e.vertices[s],e.vertices[s+1],t,i);this.setEdgeScale(n),this.addOverlay(r,n)}},h.drawPoint=function(e,t,i){if(!this.viewer.model.getData().isLeaflet){l||(l=new THREE.SphereGeometry(1));var r=new THREE.Mesh(l,t);r.position.set(e.x,e.y,e.z),this.setPointScale(r),i===a&&(this.overlayType=3),this.addOverlay(i,r)}},h.drawCircle=function(e,t,i){var r=new THREE.TorusGeometry(1.2,.2,2,20),s=new THREE.Mesh(r,t);s.lookAt(this.viewer.navigation.getEyeVector().normalize()),r=null,s.position.set(e.x,e.y,e.z),this.setCircleScale(s),this.addOverlay(i,s)},h.setScale=function(e){var t=this.viewer.navigation,i=t.getCamera(),r=t.getPosition(),s=e.clone(),n=i.isPerspective?s.sub(r).length():t.getEyeVector().length(),o=t.getVerticalFov();return 5*(2*n*Math.tan(THREE.Math.degToRad(.5*o)))/t.getScreenViewport().height},h.setPointScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.y=t,e.scale.z=t},h.setCircleScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.y=t},h.setEdgeScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.z=t},h.updatePointScale=function(e){if(3==this.overlayType){var t=this.viewer.impl.overlayScenes[e];if(t)for(var i=t.scene,r=0;r<i.children.length;r++){var s=i.children[r];s&&this.setPointScale(s)}}},h.updateEdgeScale=function(e){if(2==this.overlayType){var t=this.viewer.impl.overlayScenes[e];if(t)for(var i=t.scene,r=0;r<i.children.length;r++){var s=i.children[r];s&&this.setEdgeScale(s)}}},h.onCameraChange=function(){this.updatePointScale(a),this.updateEdgeScale(a),this.render()},h.destroy=function(){this.removeOverlay(a),this.removeOverlay(c),l&&(l.dispose(),l=null)}},81:function(e,t,i){"use strict";(function(e){function r(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:e}i.d(t,"a",(function(){return h}));var s=r(),n=s&&s.document,o="undefined"!=typeof navigator,a=o&&!!navigator.userAgent.match(/Edge|Trident\/7\./);"undefined"!=typeof window&&a&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=n.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=s.CustomEvent.prototype,s.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:t<0&&(t=this.byteLength+t)<0&&(t=0),e<0&&(e=this.byteLength+e)<0&&(e=0),t<=e)return new ArrayBuffer;for(var i=t-e,r=new Uint8Array(this,e,i),s=new Uint8Array(i),n=0;n<i;n++)s[n]=r[n];return s.buffer}),Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2},"undefined"!=typeof window&&(s.BlobBuilder=s.BlobBuilder||s.WebKitBlobBuilder||s.MozBlobBuilder||s.MSBlobBuilder);var c=o&&(/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1);function l(){return c}var u=o&&-1!==navigator.userAgent.toLowerCase().indexOf("android");function h(){return!!o&&(l()||u)}!function(){var e=r();e.performance||(e.performance=Date)}(),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},String.prototype.repeat=String.prototype.repeat||function(e){if(e<1)return"";for(var t="",i=this.valueOf();e>1;)1&e&&(t+=i),e>>=1,i+=i;return t+i},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{enumerable:!1,value:function(e,t,i){t=void 0===t?0:t,i=void 0===i?this.length:i;for(var r=t;r<i;++r)this[r]=e}}),Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||function(e,t){return Array.prototype.lastIndexOf.call(this,e,t)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(e,t){for(var i=this.length,r=0;r<i;++r){var s=this[r];if(e.call(t,s,r,this))return s}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var s=arguments[r];if(null!=s)for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i[n]=s[n])}return i},writable:!0,configurable:!0}),"undefined"==typeof window||!a&&!l()||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,i){var r=this;setTimeout((function(){for(var s=atob(r.toDataURL(t,i).split(",")[1]),n=s.length,o=new Uint8Array(n),a=0;a<n;a++)o[a]=s.charCodeAt(a);e(new Blob([o],{type:t||"image/png"}))}))}}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){if(t=void 0!==t?t:this.length,"[object Array]"===Object.prototype.toString.call(this))return _slice.call(this,e,t);var i,r,s=[],n=this.length,o=e||0;o=o>=0?o:Math.max(0,n+o);var a="number"==typeof t?Math.min(t,n):n;if(t<0&&(a=n+t),(r=a-o)>0)if(s=new Array(r),this.charAt)for(i=0;i<r;i++)s[i]=this.charAt(o+i);else for(i=0;i<r;i++)s[i]=this[o+i];return s})}).call(this,i(50))}});
//# sourceMappingURL=Snapping.min.js.map